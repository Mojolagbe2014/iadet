<?phpsession_start();define("CONST_FILE_PATH", "../includes/constants.php");include ('../classes/WebPage.php'); //Set up page as a web pagerequire '../swiftmailer/lib/swift_required.php';$thisPage = new WebPage(); //Create new instance of webPage class$dbObj = new Database();//Instantiate database$dbMoObj = new Database(MOODLE_DB_NAME);//Instantiate Databse object for moodle database$userObj = new User($dbMoObj, MOODLE_DB_PREFIX); // Cject of User class$errorArr = array(); //Array of errors$newPassword ="";if(filter_input(INPUT_POST, "email")!=NULL){    $postVars = array('email'); // Form fields names    //Validate the POST variables and add up to error message if empty    foreach ($postVars as $postVar){        switch($postVar){            case 'email':   $userObj->email = filter_input(INPUT_POST, $postVar, FILTER_VALIDATE_EMAIL) ? mysqli_real_escape_string($dbMoObj->connection, filter_input(INPUT_POST, $postVar, FILTER_VALIDATE_EMAIL)) :  '';                             if($userObj->email == "") {array_push ($errorArr, "Please enter $postVar ");}                            break;        }    }    //If validated and not empty submit it to database    if(count($errorArr) < 1)   {        if($userObj->emailExists()){            $userObj->passWord = '@Rst#'.time();            $newPassword = $userObj->passWord;            $emailAddress = filter_input(INPUT_POST, 'email', FILTER_VALIDATE_EMAIL);            $subject = "Password Reset Message";	            $body = "Your password has been reset. Email: ".$emailAddress." Password: ".$newPassword;            $headers = 'From: Admin IADET <info@iadet.net>' . "\r\n";            $headers .= 'Reply-To: info@iadet.net' . "\r\n";            $headers .= 'MIME-Version: 1.0' . "\r\n";            $headers .= 'Content-type: text/html; charset=iso-8859-1' . "\r\n";            // Create the mail transport configuration            $transport = Swift_MailTransport::newInstance();            // Create the message            $message = Swift_Message::newInstance();            $message->setTo(array($emailAddress => "IADET User"));            $message->setSubject($subject);            $message->setBody($body);            $message->setFrom("info@iadet.net", "IADET Admin");            $message->setContentType("text/html");            // Send the email            $mailer = Swift_Mailer::newInstance($transport);            $mailer->send($message);            //mail($emailAddress, $subject, $message, $headers);            echo  $userObj->resetPassword();        }else{            $json = array("status" => 0, "msg" => "The email you entered does not exist in our database.");             $dbMoObj->close();//Close Database Connection            header('Content-type: application/json');            echo json_encode($json);        }    }    //Else show error messages    else{         $json = array("status" => 0, "msg" => $errorArr);         $dbMoObj->close();//Close Database Connection        header('Content-type: application/json');        echo json_encode($json);    }}